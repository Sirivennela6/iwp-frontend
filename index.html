<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project Submission</title>
  <link rel="stylesheet" href="style.css" />
  <script defer>
    document.addEventListener("DOMContentLoaded", function() {
      document.getElementById("projectForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const MAX_MB = 4;
        const MAX_BYTES = MAX_MB * 1024 * 1024;

        const studentInfo = document.getElementById("studentInfo").value.trim();
        const title = document.getElementById("title").value.trim();
        const abstract = document.getElementById("abstract").value.trim();
        const domain = document.getElementById("domain").value.trim();
        const classSection = document.getElementById("classSection").value.trim();
        const guide = document.getElementById("guide").value.trim();
        const fileInput = document.getElementById("file");

        if (!studentInfo || !title || !abstract || !domain || !classSection || !guide || !fileInput.files.length) {
          alert("Please fill all fields and upload a file.");
          return;
        }

        const file = fileInput.files;
        if (file.size > MAX_BYTES) {
          alert(`File too large! Upload below ${MAX_MB}MB.`);
          return;
        }

        const formData = new FormData();
        formData.append("studentInfo", studentInfo);
        formData.append("title", title);
        formData.append("abstract", abstract);
        formData.append("domain", domain);
        formData.append("classSection", classSection);
        formData.append("guide", guide);
        formData.append("file", file);

        try {
          const res = await fetch("/api/upload", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          if (res.ok) {
            alert(data.message || "Project submitted successfully!");
            document.getElementById("projectForm").reset();
          } else {
            alert(data.error || "Submission failed.");
          }
        } catch (err) {
          alert("Network or server error. Please try again later.");
        }
      });
    });
  </script>
</head>
<body>
  <!-- header and nav as before -->
  <main class="form-container">
    <h2>
      <img src="https://cdn-icons-png.flaticon.com/512/716/716784.png" class="icon" alt="File Icon" />
      Project Submission
    </h2>
    <form id="projectForm">
      <label for="studentInfo">Name & Reg No</label>
      <select id="studentInfo" name="studentInfo" required>
        <option value="">Select student</option>
        <option value="Siri_2360346">Siri - 2360346</option>
        <option value="Angel_2360331">Angel - 2360331</option>
      </select>
      <label for="title">Project Title</label>
      <input type="text" id="title" name="title" placeholder="Enter project title" required />
      <label for="abstract">Abstract</label>
      <textarea id="abstract" name="abstract" rows="4" placeholder="Project abstract..." required></textarea>
      <label for="domain">Domain</label>
      <select id="domain" name="domain" required>
        <option value="">Select a domain</option>
        <option>Web Development</option>
        <option>AI/ML</option>
        <option>Cybersecurity</option>
        <option>IoT</option>
        <option>Cloud Computing</option>
      </select>
      <label for="classSection">Class and Section</label>
      <select id="classSection" name="classSection" required>
        <option value="">Select a class and section</option>
        <option>7BTCS A</option>
        <option>7BTCS B</option>
        <option>7BTIT A</option>
        <option>7BTIT B</option>
      </select>
      <label for="guide">Guide Name</label>
      <input type="text" id="guide" name="guide" placeholder="Guide's full name" required />
      <label for="file">Upload Project File (PDF, max 4MB)</label>
      <input type="file" id="file" name="file" accept=".pdf,.doc,.docx" required />
      <button type="submit">Submit</button>
    </form>
  </main>
</body>
</html>
